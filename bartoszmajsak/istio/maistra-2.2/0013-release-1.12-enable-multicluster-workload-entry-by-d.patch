From da57e5dd18fd58eaf3be09b1b1cf955512144a48 Mon Sep 17 00:00:00 2001
From: Istio Automation <istio-testing-bot@google.com>
Date: Thu, 4 Nov 2021 10:27:24 -0700
Subject: [release-1.12] enable multicluster workload entry by default (#35886)

* enable multicluster workload entry by default

Change-Id: Ic1406a838bc2851923967667701b1b69f57800b6

* release note

Change-Id: I72e1659747020d00f9db7a9b4409dceaaa1b75df

Co-authored-by: Steven Landow <landow@google.com>
---
 pilot/pkg/features/pilot.go                            |  2 +-
 releasenotes/notes/35883.yaml                          | 10 ++++++++++
 .../iop-integration-test-defaults-with-quic.yaml       |  1 -
 tests/integration/iop-integration-test-defaults.yaml   |  1 -
 4 files changed, 11 insertions(+), 3 deletions(-)
 create mode 100644 releasenotes/notes/35883.yaml

diff --git a/pilot/pkg/features/pilot.go b/pilot/pkg/features/pilot.go
index 3cc692fc99..3bc625d7e7 100644
--- a/pilot/pkg/features/pilot.go
+++ b/pilot/pkg/features/pilot.go
@@ -454,7 +454,7 @@
 	WorkloadEntryHealthChecks = env.RegisterBoolVar("PILOT_ENABLE_WORKLOAD_ENTRY_HEALTHCHECKS", true,
 		"Enables automatic health checks of WorkloadEntries based on the config provided in the associated WorkloadGroup").Get()
 
-	WorkloadEntryCrossCluster = env.RegisterBoolVar("PILOT_ENABLE_CROSS_CLUSTER_WORKLOAD_ENTRY", false,
+	WorkloadEntryCrossCluster = env.RegisterBoolVar("PILOT_ENABLE_CROSS_CLUSTER_WORKLOAD_ENTRY", true,
 		"If enabled, pilot will read WorkloadEntry from other clusters, selectable by Services in that cluster.").Get()
 
 	EnableFlowControl = env.RegisterBoolVar(
diff --git a/releasenotes/notes/35883.yaml b/releasenotes/notes/35883.yaml
new file mode 100644
index 0000000000..521b50381d
--- /dev/null
+++ b/releasenotes/notes/35883.yaml
@@ -0,0 +1,10 @@
+apiVersion: release-notes/v2
+kind: feature
+area: istioctl
+issue:
+  - 18487
+
+releaseNotes:
+- |
+  **Updated** `WorkloadEntry` resources will be read across clusters and no longer need to be manually mirrored to other
+  clusters. These endpoints are now automatically discovered and reachable in both multi-cluster and multi-network meshes.
diff --git a/tests/integration/iop-integration-test-defaults-with-quic.yaml b/tests/integration/iop-integration-test-defaults-with-quic.yaml
index 9965931638..0b9be45b90 100644
--- a/tests/integration/iop-integration-test-defaults-with-quic.yaml
+++ b/tests/integration/iop-integration-test-defaults-with-quic.yaml
@@ -60,7 +60,6 @@ spec:
       autoscaleEnabled: false
       env:
         UNSAFE_ENABLE_ADMIN_ENDPOINTS: true
-        PILOT_ENABLE_CROSS_CLUSTER_WORKLOAD_ENTRY: true
         ENABLE_MULTICLUSTER_HEADLESS: true
         PILOT_REMOTE_CLUSTER_TIMEOUT: 15s
         PILOT_ENABLE_QUIC_LISTENERS: true
diff --git a/tests/integration/iop-integration-test-defaults.yaml b/tests/integration/iop-integration-test-defaults.yaml
index 437f7ed8c2..fc24cf686e 100644
--- a/tests/integration/iop-integration-test-defaults.yaml
+++ b/tests/integration/iop-integration-test-defaults.yaml
@@ -56,7 +56,6 @@ spec:
       autoscaleEnabled: false
       env:
         UNSAFE_ENABLE_ADMIN_ENDPOINTS: true
-        PILOT_ENABLE_CROSS_CLUSTER_WORKLOAD_ENTRY: true
         ENABLE_MULTICLUSTER_HEADLESS: true
         PILOT_REMOTE_CLUSTER_TIMEOUT: 15s
 
-- 
2.35.3

