From 0f3f5823c561910ad1d42ad5305da8019a9aca9a Mon Sep 17 00:00:00 2001
From: Istio Automation <istio-testing-bot@google.com>
Date: Thu, 21 Apr 2022 08:32:14 -0700
Subject: Fix panic when kubeClient is nil (#38488)

Co-authored-by: Zhonghu Xu <xuzhonghu@huawei.com>
---
 pilot/pkg/bootstrap/mesh.go | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pilot/pkg/bootstrap/mesh.go b/pilot/pkg/bootstrap/mesh.go
index ed683f1dd8..d7868ed98e 100644
--- a/pilot/pkg/bootstrap/mesh.go
+++ b/pilot/pkg/bootstrap/mesh.go
@@ -62,7 +62,7 @@ func (s *Server) initMeshConfiguration(args *PilotArgs, fileWatcher filewatcher.
 	if _, err = os.Stat(args.MeshConfigFile); !os.IsNotExist(err) {
 		s.environment.Watcher, err = mesh.NewFileWatcher(fileWatcher, args.MeshConfigFile, multiWatch)
 		if err == nil {
-			if multiWatch {
+			if multiWatch && s.kubeClient != nil {
 				kubemesh.AddUserMeshConfig(
 					s.kubeClient, s.environment.Watcher, args.Namespace, configMapKey, features.SharedMeshConfig, s.internalStop)
 			} else {
-- 
2.35.3

