From 1449a2fe0cf79a441d7f7486dbebcbd87f84bf63 Mon Sep 17 00:00:00 2001
From: Eren Ali Dal <e.alidal@hotmail.com>
Date: Tue, 15 Mar 2022 01:13:41 +0300
Subject: arm64 for osx added to download scripts (#37893)

---
 release/downloadIstioCandidate.sh | 9 ++++++++-
 release/downloadIstioCtl.sh       | 9 ++++++++-
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/release/downloadIstioCandidate.sh b/release/downloadIstioCandidate.sh
index fab20ebf22..20bdf198f2 100755
--- a/release/downloadIstioCandidate.sh
+++ b/release/downloadIstioCandidate.sh
@@ -105,6 +105,8 @@ without_arch() {
 # Istio 1.6 and above support arch
 # Istio 1.5 and below do not have arch support
 ARCH_SUPPORTED="1.6"
+# Istio 1.10 and above support arch for osx arm64
+ARCH_SUPPORTED_OSX="1.10"
 
 if [ "${OS}" = "Linux" ] ; then
   # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED (version-sort's before it)
@@ -114,7 +116,12 @@ if [ "${OS}" = "Linux" ] ; then
     with_arch
   fi
 elif [ "${OS}" = "Darwin" ] ; then
-  without_arch
+  # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED_OSX (version-sort's before it) or ISTIO_ARCH not equal to arm64
+  if [ "$(printf '%s\n%s' "${ARCH_SUPPORTED_OSX}" "${ISTIO_VERSION}" | sort -V | head -n 1)" = "${ISTIO_VERSION}" ] || [ "${ISTIO_ARCH}" != "arm64" ]; then
+    without_arch
+  else
+    with_arch
+  fi
 else
   printf "\n\n"
   printf "Unable to download Istio %s at this moment!\n" "$ISTIO_VERSION"
diff --git a/release/downloadIstioCtl.sh b/release/downloadIstioCtl.sh
index de72518b03..f3fa305c16 100755
--- a/release/downloadIstioCtl.sh
+++ b/release/downloadIstioCtl.sh
@@ -109,6 +109,8 @@ without_arch() {
 # Istio 1.6 and above support arch
 # Istio 1.5 and below do not have arch support
 ARCH_SUPPORTED="1.6"
+# Istio 1.10 and above support arch for osx arm64
+ARCH_SUPPORTED_OSX="1.10"
 
 if [ "${OS}" = "Linux" ] ; then
   # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED (version-sort's before it)
@@ -118,7 +120,12 @@ if [ "${OS}" = "Linux" ] ; then
     with_arch
   fi
 elif [ "${OS}" = "Darwin" ] ; then
-  without_arch
+  # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED_OSX (version-sort's before it) or ISTIO_ARCH not equal to arm64
+  if [ "$(printf '%s\n%s' "${ARCH_SUPPORTED_OSX}" "${ISTIO_VERSION}" | sort -V | head -n 1)" = "${ISTIO_VERSION}" ] || [ "${ISTIO_ARCH}" != "arm64" ]; then
+    without_arch
+  else
+    with_arch
+  fi
 else
   download_failed
 fi
-- 
2.35.3

