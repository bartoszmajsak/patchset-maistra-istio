From 33422d1960ed9d9688147607d1136cd01157c7f7 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Sat, 26 Feb 2022 10:31:35 +0800
Subject: remove copystructure Mutex rewrite (#37510)

* remove copystructure Mutext rewrite

* format
---
 pilot/pkg/model/service.go | 18 +-----------------
 1 file changed, 1 insertion(+), 17 deletions(-)

diff --git a/pilot/pkg/model/service.go b/pilot/pkg/model/service.go
index d3fa19bc5c..00b731f34b 100644
--- a/pilot/pkg/model/service.go
+++ b/pilot/pkg/model/service.go
@@ -24,10 +24,8 @@
 
 import (
 	"fmt"
-	"reflect"
 	"strconv"
 	"strings"
-	"sync"
 	"time"
 
 	endpoint "github.com/envoyproxy/go-control-plane/envoy/config/endpoint/v3"
@@ -853,22 +851,8 @@ func (ep *IstioEndpoint) DeepCopy() *IstioEndpoint {
 	return copyInternal(ep).(*IstioEndpoint)
 }
 
-// Configure copystructure so that it will not copy mutexes.
-var copyInternalConfig = copystructure.Config{
-	Copiers: map[reflect.Type]copystructure.CopierFunc{
-		reflect.TypeOf(sync.Mutex{}): func(interface{}) (interface{}, error) {
-			// Return a new mutex.
-			return sync.Mutex{}, nil
-		},
-		reflect.TypeOf(sync.RWMutex{}): func(interface{}) (interface{}, error) {
-			// Return a new mutex.
-			return sync.RWMutex{}, nil
-		},
-	},
-}
-
 func copyInternal(v interface{}) interface{} {
-	copied, err := copyInternalConfig.Copy(v)
+	copied, err := copystructure.Copy(v)
 	if err != nil {
 		// There are 2 locations where errors are generated in copystructure.Copy:
 		//  * The reflection walk over the structure fails, which should never happen
-- 
2.35.3

