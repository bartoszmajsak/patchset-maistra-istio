From 5fc3738721840631e753c06077488c526f9b1a09 Mon Sep 17 00:00:00 2001
From: Rama Chavali <rama.rao@salesforce.com>
Date: Thu, 14 Apr 2022 13:00:05 +0530
Subject: minor test fixes (#38290)

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>
---
 .../networking/core/v1alpha3/cluster_builder_test.go  | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/pilot/pkg/networking/core/v1alpha3/cluster_builder_test.go b/pilot/pkg/networking/core/v1alpha3/cluster_builder_test.go
index bf061f5aff..80d7dfca99 100644
--- a/pilot/pkg/networking/core/v1alpha3/cluster_builder_test.go
+++ b/pilot/pkg/networking/core/v1alpha3/cluster_builder_test.go
@@ -2567,6 +2567,10 @@ func TestBuildUpstreamClusterTLSContext(t *testing.T) {
 	}
 	for _, tc := range testCases {
 		t.Run(tc.name, func(t *testing.T) {
+			old := features.VerifyCertAtClient
+			defer func() {
+				features.VerifyCertAtClient = old
+			}()
 			features.VerifyCertAtClient = tc.enableVerifyCertAtClient
 			var proxy *model.Proxy
 			if tc.router {
@@ -2974,9 +2978,6 @@ func TestBuildAutoMtlsSettings(t *testing.T) {
 }
 
 func TestApplyDestinationRuleOSCACert(t *testing.T) {
-	defer func() {
-		features.VerifyCertAtClient = false
-	}()
 	servicePort := model.PortList{
 		&model.Port{
 			Name:     "default",
@@ -3136,6 +3137,10 @@ func TestApplyDestinationRuleOSCACert(t *testing.T) {
 
 	for _, tt := range cases {
 		t.Run(tt.name, func(t *testing.T) {
+			old := features.VerifyCertAtClient
+			defer func() {
+				features.VerifyCertAtClient = old
+			}()
 			features.VerifyCertAtClient = tt.enableVerifyCertAtClient
 			instances := []*model.ServiceInstance{
 				{
-- 
2.35.3

