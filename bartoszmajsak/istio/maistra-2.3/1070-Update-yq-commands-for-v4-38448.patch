From c4a9172c6835cdde23228dc5177ad12862a1006f Mon Sep 17 00:00:00 2001
From: Eric Van Norman <ericvn@us.ibm.com>
Date: Tue, 19 Apr 2022 11:08:15 -0500
Subject: Update yq commands for v4 (#38448)

---
 Makefile.core.mk                           |  6 +-----
 manifests/charts/istiod-remote/values.yaml | 12 ++++++------
 2 files changed, 7 insertions(+), 11 deletions(-)

diff --git a/Makefile.core.mk b/Makefile.core.mk
index 7bd7412317..56a09324d5 100644
--- a/Makefile.core.mk
+++ b/Makefile.core.mk
@@ -379,11 +379,7 @@ copy-templates:
 
 	# copy istio-discovery values, but apply some local customizations
 	cp manifests/charts/istio-control/istio-discovery/values.yaml manifests/charts/istiod-remote/
-	yq w manifests/charts/istiod-remote/values.yaml telemetry.enabled false -i
-	yq w manifests/charts/istiod-remote/values.yaml global.externalIstiod true -i
-	yq w manifests/charts/istiod-remote/values.yaml global.omitSidecarInjectorConfigMap true -i
-	yq w manifests/charts/istiod-remote/values.yaml pilot.configMap false -i
-
+	yq -i '.telemetry.enabled=false | .global.externalIstiod=true | .global.omitSidecarInjectorConfigMap=true | .pilot.configMap=false' manifests/charts/istiod-remote/values.yaml
 # Generate kustomize templates.
 gen-kustomize:
 	helm3 template istio --namespace istio-system --include-crds manifests/charts/base > manifests/charts/base/files/gen-istio-cluster.yaml
diff --git a/manifests/charts/istiod-remote/values.yaml b/manifests/charts/istiod-remote/values.yaml
index ae41bddf4f..cca9cd2366 100644
--- a/manifests/charts/istiod-remote/values.yaml
+++ b/manifests/charts/istiod-remote/values.yaml
@@ -177,9 +177,9 @@ meshConfig:
   # It is not clear if user should normally need to configure - the metadata is typically
   # used as an escape and to control testing and rollout, but it is not intended as a long-term
   # stable API.
-# What we may configure in mesh config is the ".global" - and use of other suffixes.
-# No hurry to do this in 1.6, we're trying to prove the code.
 
+  # What we may configure in mesh config is the ".global" - and use of other suffixes.
+  # No hurry to do this in 1.6, we're trying to prove the code.
 global:
   # Used to locate istiod.
   istioNamespace: istio-system
@@ -196,10 +196,10 @@ global:
   defaultResources:
     requests:
       cpu: 10m
-      #   memory: 128Mi
-      # limits:
-      #   cpu: 100m
-      #   memory: 128Mi
+    #   memory: 128Mi
+    # limits:
+    #   cpu: 100m
+    #   memory: 128Mi
   # Default hub for Istio images.
   # Releases are published to docker hub under 'istio' project.
   # Dev builds from prow are on gcr.io
-- 
2.35.3

