From f47fa2e977dcd8f3fe19ce770ecdc16b7eb1b1a6 Mon Sep 17 00:00:00 2001
From: John Howard <howardjohn@google.com>
Date: Tue, 30 Nov 2021 22:16:45 -0800
Subject: Add test for fault abort filter (#36304)

---
 tests/integration/pilot/common/routing.go | 26 +++++++++++++++++++++++
 1 file changed, 26 insertions(+)

diff --git a/tests/integration/pilot/common/routing.go b/tests/integration/pilot/common/routing.go
index 8a07018577..b065904ee6 100644
--- a/tests/integration/pilot/common/routing.go
+++ b/tests/integration/pilot/common/routing.go
@@ -661,6 +661,32 @@ func(response echoclient.ParsedResponses, _ error) error {
 			},
 			workloadAgnostic: true,
 		},
+		TrafficTestCase{
+			name: "fault abort",
+			config: `
+apiVersion: networking.istio.io/v1alpha3
+kind: VirtualService
+metadata:
+  name: default
+spec:
+  hosts:
+  - {{ (index .dst 0).Config.Service }}
+  http:
+  - route:
+    - destination:
+        host: {{ (index .dst 0).Config.Service }}
+    fault:
+      abort:
+        percentage:
+          value: 100
+        httpStatus: 418`,
+			opts: echo.CallOptions{
+				PortName:  "http",
+				Count:     1,
+				Validator: echo.ExpectCode("418"),
+			},
+			workloadAgnostic: true,
+		},
 	)
 
 	// reduce the total # of subtests that don't give valuable coverage or just don't work
-- 
2.35.3

