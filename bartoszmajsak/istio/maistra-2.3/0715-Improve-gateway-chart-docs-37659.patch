From 0e7940128eb8405b2283742cbf71241c1972ef3d Mon Sep 17 00:00:00 2001
From: John Howard <howardjohn@google.com>
Date: Thu, 3 Mar 2022 19:37:13 -0800
Subject: Improve gateway chart docs (#37659)

---
 manifests/charts/gateway/README.md            | 21 +++++++++++++++++++
 .../charts/gateway/templates/deployment.yaml  |  1 +
 2 files changed, 22 insertions(+)

diff --git a/manifests/charts/gateway/README.md b/manifests/charts/gateway/README.md
index 31af55b443..0e58c00f20 100644
--- a/manifests/charts/gateway/README.md
+++ b/manifests/charts/gateway/README.md
@@ -35,6 +35,15 @@ To view support configuration options and documentation, run:
 helm show values istio/gateway
 ```
 
+### `image: auto` Information
+
+The image used by the chart, `auto`, may be unintuitive.
+This exists because the pod spec will be automatically populated at runtime, using the same mechanism as [Sidecar Injection](istio.io/latest/docs/setup/additional-setup/sidecar-injection).
+This allows the same configurations and lifecycle to apply to gateways as sidecars.
+
+Note: this does mean that the namespace the gateway is deployed in must not have the `istio-injection=disabled` label.
+See [Controlling the injection policy](https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#controlling-the-injection-policy) for more info.
+
 ### Examples
 
 #### Egress Gateway
@@ -63,6 +72,18 @@ If you are able to, a clean installation is simpler. However, this often require
 
 WARNING: when installing over an existing deployment, the two deployments will be merged together by Helm, which may lead to unexpected results.
 
+#### Legacy Gateway Helm charts
+
+Istio historically offered two different charts - `manifests/charts/gateways/istio-ingress` and `manifests/charts/gateways/istio-egress`.
+These are replaced by this chart.
+While not required, it is recommended all new users use this chart, and existing users migrate when possible.
+
+This chart has the following benefits and differences:
+* Designed with Helm best practices in mind (standardized values options, values schema, values are not all nested under `gateways.istio-ingressgateway.*`, release name and namespace taken into account, etc).
+* Utilizes Gateway injection, simplifying upgrades, allowing gateways to run in any namespace, and avoiding repeating config for sidecars and gateways.
+* Published to official Istio Helm repository.
+* Single chart for all gateways (Ingress, Egress, East West).
+
 #### General concerns
 
 For a smooth migration, the resource names and `Deployment.spec.selector` labels must match.
diff --git a/manifests/charts/gateway/templates/deployment.yaml b/manifests/charts/gateway/templates/deployment.yaml
index b8e1f17791..0deb9951cc 100644
--- a/manifests/charts/gateway/templates/deployment.yaml
+++ b/manifests/charts/gateway/templates/deployment.yaml
@@ -43,6 +43,7 @@ spec:
       {{- end }}
       containers:
         - name: istio-proxy
+          # "auto" will be populated at runtime by the mutating webhook. See https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#customizing-injection
           image: auto
           securityContext:
           {{- if .Values.containerSecurityContext }}
-- 
2.35.3

