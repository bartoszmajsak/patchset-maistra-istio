From 00c13f831329dd387d99ed924e135b7ed83ea22f Mon Sep 17 00:00:00 2001
From: John Howard <howardjohn@google.com>
Date: Tue, 26 Apr 2022 14:50:05 -0700
Subject: base: use iptables_legacy (#38598)

Long live iptables

Fixes https://github.com/istio/istio/pull/38583
---
 docker/Dockerfile.base | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/docker/Dockerfile.base b/docker/Dockerfile.base
index 847e22b291..2d383f3b4e 100644
--- a/docker/Dockerfile.base
+++ b/docker/Dockerfile.base
@@ -25,7 +25,9 @@ RUN apt-get update && \
   && update-ca-certificates \
   && apt-get upgrade -y \
   && apt-get clean \
-  && rm -rf  /var/log/*log /var/lib/apt/lists/* /var/log/apt/* /var/lib/dpkg/*-old /var/cache/debconf/*-old
+  && rm -rf  /var/log/*log /var/lib/apt/lists/* /var/log/apt/* /var/lib/dpkg/*-old /var/cache/debconf/*-old \
+  && update-alternatives --set iptables /usr/sbin/iptables-legacy \
+  && update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
 
 # Sudoers used to allow tcpdump and other debug utilities.
 RUN useradd -m --uid 1337 istio-proxy && \
-- 
2.35.3

