From 89eda722637f1814aa126ed67d79714bd8eb5950 Mon Sep 17 00:00:00 2001
From: ramanujadasu <vsrr.ramanujadasu@rakuten.com>
Date: Thu, 5 May 2022 16:32:00 +0530
Subject: Fix todo testconfigwriter (#38727)

* fix: enable bootstrapdump test condition

* fix: test case issues
---
 .../envoy/configdump/configdump_test.go       | 11 ++++-----
 .../configdump/testdata/bootstrapdump.json    | 23 +++++++++++++++++++
 2 files changed, 28 insertions(+), 6 deletions(-)
 create mode 100644 istioctl/pkg/writer/envoy/configdump/testdata/bootstrapdump.json

diff --git a/istioctl/pkg/writer/envoy/configdump/configdump_test.go b/istioctl/pkg/writer/envoy/configdump/configdump_test.go
index 313189541d..1f4e6d6df8 100644
--- a/istioctl/pkg/writer/envoy/configdump/configdump_test.go
+++ b/istioctl/pkg/writer/envoy/configdump/configdump_test.go
@@ -65,12 +65,11 @@ func TestConfigWriter_PrintBootstrapDump(t *testing.T) {
 		callPrime      bool
 		wantErr        bool
 	}{
-		// TODO: Turn on when protobuf bug is resolved - https://github.com/golang/protobuf/issues/632
-		// {
-		// 	name:           "returns expected bootstrap dump from Envoy onto Stdout",
-		// 	callPrime:      true,
-		// 	wantOutputFile: "testdata/bootstrapdump.json",
-		// },
+		{
+			name:           "returns expected bootstrap dump from Envoy onto Stdout",
+			callPrime:      true,
+			wantOutputFile: "testdata/bootstrapdump.json",
+		},
 		{
 			name:    "errors if config dump is not primed",
 			wantErr: true,
diff --git a/istioctl/pkg/writer/envoy/configdump/testdata/bootstrapdump.json b/istioctl/pkg/writer/envoy/configdump/testdata/bootstrapdump.json
new file mode 100644
index 0000000000..fc39fef8f9
--- /dev/null
+++ b/istioctl/pkg/writer/envoy/configdump/testdata/bootstrapdump.json
@@ -0,0 +1,23 @@
+{
+    "bootstrap": {
+        "node": {
+            "metadata": {
+                    "ISTIO_PROXY_SHA": "istio-proxy:436f365a8007cd8a13a9f1321e7cce94bcc8883e",
+                    "ISTIO_VERSION": "1.10.0"
+                },
+            "userAgentBuildVersion": {
+                "version": {
+                    "majorNumber": 1,
+                    "minorNumber": 18,
+                    "patch": 3
+                },
+                "metadata": {
+                        "build.type": "RELEASE",
+                        "revision.sha": "436f365a8007cd8a13a9f1321e7cce94bcc8883e",
+                        "revision.status": "Clean",
+                        "ssl.version": "BoringSSL"
+                    }
+            }
+        }
+    }
+}
\ No newline at end of file
-- 
2.35.3

