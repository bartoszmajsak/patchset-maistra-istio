From b43725b9d7fe4a71fcadbc36c743bc0d6b518107 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Thu, 28 Apr 2022 17:11:33 +0800
Subject: Allow UnknownFlags (#38543)

* Allow UnknownFlags

* Add release note
---
 pilot/cmd/pilot-discovery/app/cmd.go | 8 ++++++++
 releasenotes/notes/38543.yaml        | 7 +++++++
 2 files changed, 15 insertions(+)
 create mode 100644 releasenotes/notes/38543.yaml

diff --git a/pilot/cmd/pilot-discovery/app/cmd.go b/pilot/cmd/pilot-discovery/app/cmd.go
index b6b57bbb6c..52bb6577c2 100644
--- a/pilot/cmd/pilot-discovery/app/cmd.go
+++ b/pilot/cmd/pilot-discovery/app/cmd.go
@@ -45,6 +45,10 @@ func NewRootCommand() *cobra.Command {
 		Short:        "Istio Pilot.",
 		Long:         "Istio Pilot provides fleet-wide traffic management capabilities in the Istio Service Mesh.",
 		SilenceUsage: true,
+		FParseErrWhitelist: cobra.FParseErrWhitelist{
+			// Allow unknown flags for backward-compatibility.
+			UnknownFlags: true,
+		},
 		PreRunE: func(c *cobra.Command, args []string) error {
 			cmd.AddFlags(c)
 			return nil
@@ -70,6 +74,10 @@ func newDiscoveryCommand() *cobra.Command {
 		Use:   "discovery",
 		Short: "Start Istio proxy discovery service.",
 		Args:  cobra.ExactArgs(0),
+		FParseErrWhitelist: cobra.FParseErrWhitelist{
+			// Allow unknown flags for backward-compatibility.
+			UnknownFlags: true,
+		},
 		PreRunE: func(c *cobra.Command, args []string) error {
 			if err := log.Configure(loggingOptions); err != nil {
 				return err
diff --git a/releasenotes/notes/38543.yaml b/releasenotes/notes/38543.yaml
new file mode 100644
index 0000000000..cfd0d51e80
--- /dev/null
+++ b/releasenotes/notes/38543.yaml
@@ -0,0 +1,7 @@
+apiVersion: release-notes/v2
+kind: feature
+area: traffic-management
+
+releaseNotes:
+  - |
+    **Updated** pilot discovery allow unknown flags for backward-compatibility, if an unknown flag passes, no error or warning will be logged.
-- 
2.35.3

