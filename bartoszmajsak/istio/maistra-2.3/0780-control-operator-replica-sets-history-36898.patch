From 242d562cd3a909371628f5bc55400743bd7d866c Mon Sep 17 00:00:00 2001
From: Tareq Sharafy <tareq.sha@gmail.com>
Date: Sat, 12 Mar 2022 00:36:50 +0200
Subject: control operator replica sets history (#36898)

* control operator replica sets history

* gen
---
 manifests/charts/istio-operator/files/gen-operator.yaml   | 1 +
 manifests/charts/istio-operator/templates/deployment.yaml | 1 +
 manifests/charts/istio-operator/values.yaml               | 3 +++
 3 files changed, 5 insertions(+)

diff --git a/manifests/charts/istio-operator/files/gen-operator.yaml b/manifests/charts/istio-operator/files/gen-operator.yaml
index 193ed3938e..30ffcbb1d6 100644
--- a/manifests/charts/istio-operator/files/gen-operator.yaml
+++ b/manifests/charts/istio-operator/files/gen-operator.yaml
@@ -162,6 +162,7 @@ metadata:
   name: istio-operator
 spec:
   replicas: 1
+  revisionHistoryLimit: 10
   selector:
     matchLabels:
       name: istio-operator
diff --git a/manifests/charts/istio-operator/templates/deployment.yaml b/manifests/charts/istio-operator/templates/deployment.yaml
index 5fc32f5905..688fa1d49d 100644
--- a/manifests/charts/istio-operator/templates/deployment.yaml
+++ b/manifests/charts/istio-operator/templates/deployment.yaml
@@ -5,6 +5,7 @@ metadata:
   name: istio-operator{{- if not (eq .Values.revision "") }}-{{ .Values.revision }}{{- end }}
 spec:
   replicas: 1
+  revisionHistoryLimit: {{ .Values.deploymentHistory }}
   selector:
     matchLabels:
       name: istio-operator
diff --git a/manifests/charts/istio-operator/values.yaml b/manifests/charts/istio-operator/values.yaml
index f0d698a71f..3b2d912244 100644
--- a/manifests/charts/istio-operator/values.yaml
+++ b/manifests/charts/istio-operator/values.yaml
@@ -15,6 +15,9 @@ enableCRDTemplates: false
 # revision for the operator resources
 revision: ""
 
+# The number of old ReplicaSets to retain in operator deployment
+deploymentHistory: 10
+
 # Operator resource defaults
 operator:
   resources:
-- 
2.35.3

