From 026e119a9abedd973b5efb5a95c64204069e8153 Mon Sep 17 00:00:00 2001
From: Yang <940129520@qq.com>
Date: Wed, 26 Jan 2022 03:31:43 +0800
Subject: Avoid duplicated sort operation for status list (#36988)

---
 pilot/pkg/config/kube/ingress/status.go   | 8 +++++++-
 pilot/pkg/config/kube/ingressv1/status.go | 8 +++++++-
 2 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/pilot/pkg/config/kube/ingress/status.go b/pilot/pkg/config/kube/ingress/status.go
index 5a7982698a..5ca571cb6e 100644
--- a/pilot/pkg/config/kube/ingress/status.go
+++ b/pilot/pkg/config/kube/ingress/status.go
@@ -124,6 +124,13 @@ func (s *StatusSyncer) updateStatus(status []coreV1.LoadBalancerIngress) error {
 	if err != nil {
 		return err
 	}
+
+	if len(l) == 0 {
+		return nil
+	}
+
+	sort.SliceStable(status, lessLoadBalancerIngress(status))
+
 	for _, currIng := range l {
 		shouldTarget, err := s.shouldTargetIngress(currIng)
 		if err != nil {
@@ -135,7 +142,6 @@ func (s *StatusSyncer) updateStatus(status []coreV1.LoadBalancerIngress) error {
 		}
 
 		curIPs := currIng.Status.LoadBalancer.Ingress
-		sort.SliceStable(status, lessLoadBalancerIngress(status))
 		sort.SliceStable(curIPs, lessLoadBalancerIngress(curIPs))
 
 		if ingressSliceEqual(status, curIPs) {
diff --git a/pilot/pkg/config/kube/ingressv1/status.go b/pilot/pkg/config/kube/ingressv1/status.go
index 6fff2a9ba8..a283e45110 100644
--- a/pilot/pkg/config/kube/ingressv1/status.go
+++ b/pilot/pkg/config/kube/ingressv1/status.go
@@ -118,6 +118,13 @@ func (s *StatusSyncer) updateStatus(status []coreV1.LoadBalancerIngress) error {
 	if err != nil {
 		return err
 	}
+
+	if len(l) == 0 {
+		return nil
+	}
+
+	sort.SliceStable(status, lessLoadBalancerIngress(status))
+
 	for _, currIng := range l {
 		shouldTarget, err := s.shouldTargetIngress(currIng)
 		if err != nil {
@@ -129,7 +136,6 @@ func (s *StatusSyncer) updateStatus(status []coreV1.LoadBalancerIngress) error {
 		}
 
 		curIPs := currIng.Status.LoadBalancer.Ingress
-		sort.SliceStable(status, lessLoadBalancerIngress(status))
 		sort.SliceStable(curIPs, lessLoadBalancerIngress(curIPs))
 
 		if ingressSliceEqual(status, curIPs) {
-- 
2.35.3

