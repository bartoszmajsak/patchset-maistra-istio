From 0fecd2109aa2e365bb972215bd68d45abc8fe6e5 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Wed, 16 Feb 2022 11:39:09 +0800
Subject: Ignore proxyconfig for all xds push and ignore wle for lds (#37342)

---
 pilot/pkg/xds/cds.go | 1 +
 pilot/pkg/xds/eds.go | 1 +
 pilot/pkg/xds/lds.go | 5 +++++
 pilot/pkg/xds/rds.go | 2 ++
 4 files changed, 9 insertions(+)

diff --git a/pilot/pkg/xds/cds.go b/pilot/pkg/xds/cds.go
index 968d6fb488..81fd5f12e9 100644
--- a/pilot/pkg/xds/cds.go
+++ b/pilot/pkg/xds/cds.go
@@ -36,6 +36,7 @@ type CdsGenerator struct {
 	gvk.Secret:                {},
 	gvk.Telemetry:             {},
 	gvk.WasmPlugin:            {},
+	gvk.ProxyConfig:           {},
 }
 
 // Map all configs that impacts CDS for gateways.
diff --git a/pilot/pkg/xds/eds.go b/pilot/pkg/xds/eds.go
index 6f92992cbc..599864b088 100644
--- a/pilot/pkg/xds/eds.go
+++ b/pilot/pkg/xds/eds.go
@@ -436,6 +436,7 @@ type EdsGenerator struct {
 	gvk.Secret:                {},
 	gvk.Telemetry:             {},
 	gvk.WasmPlugin:            {},
+	gvk.ProxyConfig:           {},
 }
 
 func edsNeedsPush(updates model.XdsUpdates) bool {
diff --git a/pilot/pkg/xds/lds.go b/pilot/pkg/xds/lds.go
index 7eb219e9de..65bd8806d4 100644
--- a/pilot/pkg/xds/lds.go
+++ b/pilot/pkg/xds/lds.go
@@ -34,12 +34,17 @@ type LdsGenerator struct {
 	model.Router: {
 		// for autopassthrough gateways, we build filterchains per-dr subset
 		gvk.WorkloadGroup: {},
+		gvk.WorkloadEntry: {},
 		gvk.Secret:        {},
+		gvk.ProxyConfig:   {},
 	},
 	model.SidecarProxy: {
+		gvk.Gateway:         {},
 		gvk.DestinationRule: {},
 		gvk.WorkloadGroup:   {},
+		gvk.WorkloadEntry:   {},
 		gvk.Secret:          {},
+		gvk.ProxyConfig:     {},
 	},
 }
 
diff --git a/pilot/pkg/xds/rds.go b/pilot/pkg/xds/rds.go
index ff5cd82a02..6b142ac557 100644
--- a/pilot/pkg/xds/rds.go
+++ b/pilot/pkg/xds/rds.go
@@ -35,6 +35,8 @@ type RdsGenerator struct {
 	gvk.PeerAuthentication:    {},
 	gvk.Secret:                {},
 	gvk.WasmPlugin:            {},
+	gvk.Telemetry:             {},
+	gvk.ProxyConfig:           {},
 }
 
 func rdsNeedsPush(req *model.PushRequest) bool {
-- 
2.35.3

