From cc8a1aa7ee560abf45a17ef50632e0d9204bbe13 Mon Sep 17 00:00:00 2001
From: Steven Landow <steven@stlcomputerservices.com>
Date: Wed, 2 Feb 2022 11:16:31 -0800
Subject: TestGatewayHostnames: use non-priv port (#37127)

Change-Id: I6ea039e4bac0acc83d0f7b006ea9cf14d86107cf
---
 pilot/pkg/model/network_test.go | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/pilot/pkg/model/network_test.go b/pilot/pkg/model/network_test.go
index ce3eef0a4d..960141431f 100644
--- a/pilot/pkg/model/network_test.go
+++ b/pilot/pkg/model/network_test.go
@@ -41,8 +41,8 @@ func TestGatewayHostnames(t *testing.T) {
 	})
 
 	gwHost := "test.gw.istio.io"
-	dnsServer := newFakeDNSServer(1, sets.NewSet(gwHost))
-	model.NetworkGatewayTestDNSServers = []string{"localhost:53"}
+	dnsServer := newFakeDNSServer(":10053", 1, sets.NewSet(gwHost))
+	model.NetworkGatewayTestDNSServers = []string{"localhost:10053"}
 	t.Cleanup(func() {
 		if err := dnsServer.Shutdown(); err != nil {
 			t.Logf("failed shutting down fake dns server")
@@ -101,9 +101,9 @@ type fakeDNSServer struct {
 	hosts map[string]int
 }
 
-func newFakeDNSServer(ttl uint32, hosts sets.Set) *fakeDNSServer {
+func newFakeDNSServer(addr string, ttl uint32, hosts sets.Set) *fakeDNSServer {
 	s := &fakeDNSServer{
-		Server: &dns.Server{Addr: ":53", Net: "udp"},
+		Server: &dns.Server{Addr: addr, Net: "udp"},
 		ttl:    ttl,
 		hosts:  make(map[string]int, len(hosts)),
 	}
-- 
2.35.3

