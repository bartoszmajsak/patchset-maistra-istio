From fa4af32da95bd075c90b35314a838b8aef64994c Mon Sep 17 00:00:00 2001
From: zirain <hejianpeng2@huawei.com>
Date: Wed, 11 May 2022 23:33:32 +0800
Subject: revert PR #38659 (#38826)

---
 pkg/config/analysis/local/istiod_analyze.go | 24 +--------------------
 releasenotes/notes/38659.yaml               |  8 -------
 2 files changed, 1 insertion(+), 31 deletions(-)
 delete mode 100644 releasenotes/notes/38659.yaml

diff --git a/pkg/config/analysis/local/istiod_analyze.go b/pkg/config/analysis/local/istiod_analyze.go
index 56dbd921a1..92bd4dcb75 100644
--- a/pkg/config/analysis/local/istiod_analyze.go
+++ b/pkg/config/analysis/local/istiod_analyze.go
@@ -30,7 +30,6 @@
 
 	"istio.io/api/annotation"
 	"istio.io/api/mesh/v1alpha1"
-	"istio.io/istio/istioctl/pkg/tag"
 	"istio.io/istio/pilot/pkg/config/aggregate"
 	"istio.io/istio/pilot/pkg/config/file"
 	"istio.io/istio/pilot/pkg/config/kube/crdclient"
@@ -262,28 +261,7 @@ func (sa *IstiodAnalyzer) AddReaderKubeSource(readers []ReaderSource) error {
 // AddRunningKubeSource adds a source based on a running k8s cluster to the current IstiodAnalyzer
 // Also tries to get mesh config from the running cluster, if it can
 func (sa *IstiodAnalyzer) AddRunningKubeSource(c kubelib.Client) {
-	for _, tag := range listRevision(c).UnsortedList() {
-		sa.AddRunningKubeSourceWithRevision(c, tag)
-	}
-}
-
-func listRevision(c kubelib.Client) sets.Set {
-	revisions := sets.New("default")
-	tagWebhooks, err := tag.GetTagWebhooks(context.Background(), c.Kube())
-	if err != nil {
-		return revisions
-	}
-
-	for _, wh := range tagWebhooks {
-		tagName, err := tag.GetWebhookTagName(wh)
-		if err != nil {
-			continue
-		}
-
-		revisions.Insert(tagName)
-	}
-
-	return revisions
+	sa.AddRunningKubeSourceWithRevision(c, "default")
 }
 
 func (sa *IstiodAnalyzer) AddRunningKubeSourceWithRevision(c kubelib.Client, revision string) {
diff --git a/releasenotes/notes/38659.yaml b/releasenotes/notes/38659.yaml
deleted file mode 100644
index a4186c6dab..0000000000
--- a/releasenotes/notes/38659.yaml
+++ /dev/null
@@ -1,8 +0,0 @@
-apiVersion: release-notes/v2
-kind: bug-fix
-area: installation
-issue:
-  - 38148
-releaseNotes:
-  - |
-    **Fixed** istioctl should add kubernetes resource in all revisions when running analyze.
-- 
2.35.3

