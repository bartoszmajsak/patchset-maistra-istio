From 58bf6cb2d21e08daa2b40ffbe7005595738cf760 Mon Sep 17 00:00:00 2001
From: John Howard <howardjohn@google.com>
Date: Fri, 4 Feb 2022 11:12:52 -0800
Subject: Add more robust calls to ecc_signature test (#37171)

See
https://prow.istio.io/view/gs/istio-prow/pr-logs/pull/istio_istio/37162/integ-security-istiodremote_istio/1489422915270086656
---
 .../ecc_signature_algorithm/mtls_strict_test.go   | 15 ++++++---------
 1 file changed, 6 insertions(+), 9 deletions(-)

diff --git a/tests/integration/security/ecc_signature_algorithm/mtls_strict_test.go b/tests/integration/security/ecc_signature_algorithm/mtls_strict_test.go
index 55322561e2..ffb0e438fb 100644
--- a/tests/integration/security/ecc_signature_algorithm/mtls_strict_test.go
+++ b/tests/integration/security/ecc_signature_algorithm/mtls_strict_test.go
@@ -70,17 +70,14 @@ func TestStrictMTLS(t *testing.T) {
 			t.ConfigIstio().ApplyYAMLOrFail(t, apps.Namespace.Name(), drTemplate)
 			util.WaitForConfig(t, apps.Namespace, drTemplate)
 
-			response := apps.Client.CallOrFail(t, echo.CallOptions{
-				Target:   apps.Server,
-				PortName: "http",
-				Scheme:   scheme.HTTP,
-				Count:    1,
+			apps.Client.CallWithRetryOrFail(t, echo.CallOptions{
+				Target:    apps.Server,
+				PortName:  "http",
+				Scheme:    scheme.HTTP,
+				Count:     1,
+				Validator: echo.ExpectOK(),
 			})
 
-			if err := response.CheckOK(); err != nil {
-				t.Fatalf("client could not reach server: %v", err)
-			}
-
 			certPEMs := cert.DumpCertFromSidecar(t, apps.Client, apps.Server, "http")
 			block, _ := pem.Decode([]byte(strings.Join(certPEMs, "\n")))
 			if block == nil { // nolint: staticcheck
-- 
2.35.3

