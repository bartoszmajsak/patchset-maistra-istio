From d2ba3c61d564c0af414674d872a79a2359a5d271 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Fri, 21 Jan 2022 15:34:34 +0800
Subject: remove aggregator AppendWorkloadHandler implement to prevent misuse
 (#36908)

---
 pilot/pkg/serviceregistry/aggregate/controller.go | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/pilot/pkg/serviceregistry/aggregate/controller.go b/pilot/pkg/serviceregistry/aggregate/controller.go
index 52e9bdd34b..33005067a9 100644
--- a/pilot/pkg/serviceregistry/aggregate/controller.go
+++ b/pilot/pkg/serviceregistry/aggregate/controller.go
@@ -78,7 +78,6 @@ func (c *Controller) addRegistry(registry serviceregistry.Instance, stop <-chan
 	// Observe the registry for events.
 	registry.AppendNetworkGatewayHandler(c.NotifyGatewayHandlers)
 	registry.AppendServiceHandler(c.handlers.NotifyServiceHandlers)
-	registry.AppendWorkloadHandler(c.handlers.NotifyWorkloadHandlers)
 }
 
 // AddRegistry adds registries into the aggregated controller.
@@ -340,7 +339,9 @@ func (c *Controller) AppendServiceHandler(f func(*model.Service, model.Event)) {
 }
 
 func (c *Controller) AppendWorkloadHandler(f func(*model.WorkloadInstance, model.Event)) {
-	c.handlers.AppendWorkloadHandler(f)
+	// Currently, it is not used.
+	// Note: take care when you want to enable it, it will register the handlers to all registries
+	// c.handlers.AppendWorkloadHandler(f)
 }
 
 // GetIstioServiceAccounts implements model.ServiceAccounts operation.
-- 
2.35.3

