From 30fd2f0c9149ab8dc6410ea4de129634110ac6e1 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Tue, 12 Apr 2022 10:41:47 +0800
Subject: Remove legacy monitoring (#38317)

---
 security/pkg/nodeagent/sds/monitoring.go | 65 ------------------------
 1 file changed, 65 deletions(-)
 delete mode 100644 security/pkg/nodeagent/sds/monitoring.go

diff --git a/security/pkg/nodeagent/sds/monitoring.go b/security/pkg/nodeagent/sds/monitoring.go
deleted file mode 100644
index 8a087e85c5..0000000000
--- a/security/pkg/nodeagent/sds/monitoring.go
+++ /dev/null
@@ -1,65 +0,0 @@
-// Copyright Istio Authors
-//
-// Licensed under the Apache License, Version 2.0 (the "License");
-// you may not use this file except in compliance with the License.
-// You may obtain a copy of the License at
-//
-//     http://www.apache.org/licenses/LICENSE-2.0
-//
-// Unless required by applicable law or agreed to in writing, software
-// distributed under the License is distributed on an "AS IS" BASIS,
-// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-// See the License for the specific language governing permissions and
-// limitations under the License.
-
-package sds
-
-import (
-	"istio.io/pkg/monitoring"
-)
-
-// TODO(JimmyCYJ): Create an endpoint in Citadel agent to expose metrics.
-// Previously exposed metrics: pending_push_per_connection, stale_conn_count_per_connection,
-// pushes_per_connection, push_errors_per_connection, pushed_root_cert_expiry_timestamp, pushed_server_cert_expiry_timestamp
-var (
-	// totalPushCounts records total number of SDS pushes since server starts serving.
-	totalPushCounts = monitoring.NewSum(
-		"total_pushes",
-		"The total number of SDS pushes.",
-	)
-
-	// totalPushErrorCounts records total number of failed SDS pushes since server starts serving.
-	totalPushErrorCounts = monitoring.NewSum(
-		"total_push_errors",
-		"The total number of failed SDS pushes.",
-	)
-
-	// totalActiveConnCounts records total number of active SDS connections.
-	totalActiveConnCounts = monitoring.NewSum(
-		"total_active_connections",
-		"The total number of active SDS connections.",
-	)
-
-	// totalStaleConnCounts records total number of stale SDS connections.
-	totalStaleConnCounts = monitoring.NewSum(
-		"total_stale_connections",
-		"The total number of stale SDS connections.",
-	)
-
-	// totalSecretUpdateFailureCounts records total number of secret update failures reported by
-	// proxy in SDS request <error_detail> field.
-	totalSecretUpdateFailureCounts = monitoring.NewSum(
-		"total_secret_update_failures",
-		"The total number of dynamic secret update failures reported by proxy.",
-	)
-)
-
-func init() {
-	monitoring.MustRegister(
-		totalPushCounts,
-		totalPushErrorCounts,
-		totalActiveConnCounts,
-		totalStaleConnCounts,
-		totalSecretUpdateFailureCounts,
-	)
-}
-- 
2.35.3

