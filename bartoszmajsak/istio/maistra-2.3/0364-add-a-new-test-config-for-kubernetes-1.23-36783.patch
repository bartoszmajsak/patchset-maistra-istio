From 6bf0e509cf4ce4076e420b77aceffb943f9302c9 Mon Sep 17 00:00:00 2001
From: dwq <41563853+dddddai@users.noreply.github.com>
Date: Tue, 11 Jan 2022 11:24:00 +0800
Subject: add a new test config for kubernetes 1.23 (#36783)

Signed-off-by: dddddai <dddwq@foxmail.com>
---
 prow/config/{mixedlb-service.yaml => default.yaml} | 4 ++--
 prow/config/mixedlb-service.yaml                   | 1 -
 prow/integ-suite-kind.sh                           | 2 +-
 3 files changed, 3 insertions(+), 4 deletions(-)
 copy prow/config/{mixedlb-service.yaml => default.yaml} (94%)

diff --git a/prow/config/mixedlb-service.yaml b/prow/config/default.yaml
similarity index 94%
copy from prow/config/mixedlb-service.yaml
copy to prow/config/default.yaml
index 850fbd5d6e..1f2453aa7a 100644
--- a/prow/config/mixedlb-service.yaml
+++ b/prow/config/default.yaml
@@ -1,5 +1,5 @@
-# This configs KinD to spin up a k8s cluster with mixed protocol LB support
-# This should be used to create K8s clusters with versions >= 1.20
+# This configs KinD to spin up a k8s cluster with mixed protocol LB support and GRPCContainerProbe enabled
+# This should be used to create K8s clusters with versions >= 1.23
 kind: Cluster
 apiVersion: kind.x-k8s.io/v1alpha4
 featureGates:
diff --git a/prow/config/mixedlb-service.yaml b/prow/config/mixedlb-service.yaml
index 850fbd5d6e..d105456ddd 100644
--- a/prow/config/mixedlb-service.yaml
+++ b/prow/config/mixedlb-service.yaml
@@ -5,7 +5,6 @@ apiVersion: kind.x-k8s.io/v1alpha4
 featureGates:
   MixedProtocolLBService: true
   EndpointSlice: true
-  GRPCContainerProbe: true
 kubeadmConfigPatches:
   - |
     apiVersion: kubeadm.k8s.io/v1beta2
diff --git a/prow/integ-suite-kind.sh b/prow/integ-suite-kind.sh
index 1a5b2ad471..4e2d2f8725 100755
--- a/prow/integ-suite-kind.sh
+++ b/prow/integ-suite-kind.sh
@@ -133,7 +133,7 @@ export ARTIFACTS="${ARTIFACTS:-$(mktemp -d)}"
 trace "init" make init
 
 if [[ -z "${SKIP_SETUP:-}" ]]; then
-  export DEFAULT_CLUSTER_YAML="./prow/config/mixedlb-service.yaml"
+  export DEFAULT_CLUSTER_YAML="./prow/config/default.yaml"
   export METRICS_SERVER_CONFIG_DIR='./prow/config/metrics'
 
   if [[ "${TOPOLOGY}" == "SINGLE_CLUSTER" ]]; then
-- 
2.35.3

