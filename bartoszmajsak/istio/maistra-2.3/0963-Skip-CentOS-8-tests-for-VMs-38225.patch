From e41b4dc6852ffd22d5539229212dbfaa5ce1aaf7 Mon Sep 17 00:00:00 2001
From: John Howard <howardjohn@google.com>
Date: Fri, 1 Apr 2022 10:09:52 -0700
Subject: Skip CentOS 8 tests for VMs (#38225)

See https://github.com/istio/istio/issues/38224
---
 .../components/echo/kube/deployment.go        |  2 +-
 prow/lib.sh                                   |  4 ++-
 tools/docker.yaml                             | 28 ++++++++++---------
 3 files changed, 19 insertions(+), 15 deletions(-)

diff --git a/pkg/test/framework/components/echo/kube/deployment.go b/pkg/test/framework/components/echo/kube/deployment.go
index cd080ff407..dd2e3f45f7 100644
--- a/pkg/test/framework/components/echo/kube/deployment.go
+++ b/pkg/test/framework/components/echo/kube/deployment.go
@@ -616,7 +616,7 @@ func GenerateService(cfg echo.Config) (string, error) {
 	echo.UbuntuJammy:  "app_sidecar_ubuntu_jammy",
 	echo.Debian11:     "app_sidecar_debian_11",
 	echo.Centos7:      "app_sidecar_centos_7",
-	echo.Rockylinux8:  "app_sidecar_rockylinux_8",
+	// echo.Rockylinux8:  "app_sidecar_rockylinux_8", TODO(https://github.com/istio/istio/issues/38224)
 }
 
 var RevVMImages = func() map[string]echo.VMDistro {
diff --git a/prow/lib.sh b/prow/lib.sh
index 0c8d96e5b9..d3bee6ed39 100755
--- a/prow/lib.sh
+++ b/prow/lib.sh
@@ -119,7 +119,9 @@ function build_images() {
   nonDistrolessTargets="docker.app docker.app_sidecar_ubuntu_jammy "
   if [[ "${JOB_TYPE:-presubmit}" == "postsubmit" ]]; then
     # We run tests across all VM types only in postsubmit
-    nonDistrolessTargets+="docker.app_sidecar_ubuntu_xenial docker.app_sidecar_debian_11  docker.app_sidecar_centos_7 docker.app_sidecar_rockylinux_8 "
+    nonDistrolessTargets+="docker.app_sidecar_ubuntu_xenial docker.app_sidecar_debian_11  docker.app_sidecar_centos_7 "
+    # TODO(https://github.com/istio/istio/issues/38224)
+#    nonDistrolessTargets+="docker.app_sidecar_rockylinux_8 "
   fi
   if [[ "${SELECT_TEST}" == "test.integration.operator.kube" || "${SELECT_TEST}" == "test.integration.kube" || "${JOB_TYPE:-postsubmit}" == "postsubmit" ]]; then
     targets+="docker.operator "
diff --git a/tools/docker.yaml b/tools/docker.yaml
index 2eeac84a06..0e6e4fae9b 100644
--- a/tools/docker.yaml
+++ b/tools/docker.yaml
@@ -75,16 +75,17 @@ images:
   - ${TARGET_OUT_LINUX}/client
   - ${TARGET_OUT_LINUX}/server
 
-- name: app_sidecar_rockylinux_8
-  dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_centos_8
-  files:
-  - tools/packaging/common/envoy_bootstrap.json
-  - tests/testdata/certs
-  - pkg/test/echo/docker/echo-start.sh
-  targets:
-  - ${TARGET_OUT_LINUX}/release/istio-sidecar.rpm
-  - ${TARGET_OUT_LINUX}/client
-  - ${TARGET_OUT_LINUX}/server
+# TODO(https://github.com/istio/istio/issues/38224)
+#- name: app_sidecar_rockylinux_8
+#  dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_centos_8
+#  files:
+#  - tools/packaging/common/envoy_bootstrap.json
+#  - tests/testdata/certs
+#  - pkg/test/echo/docker/echo-start.sh
+#  targets:
+#  - ${TARGET_OUT_LINUX}/release/istio-sidecar.rpm
+#  - ${TARGET_OUT_LINUX}/client
+#  - ${TARGET_OUT_LINUX}/server
 - name: app_sidecar_centos_7
   dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_centos_7
   files:
@@ -136,9 +137,10 @@ images:
 - name: app_sidecar_base_ubuntu_xenial # oldest supported ubuntu
   dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_base
   base: true
-- name: app_sidecar_base_rockylinux_8 # newest RHEL-based
-  dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_base_centos
-  base: true
+#  TODO(https://github.com/istio/istio/issues/38224)
+#- name: app_sidecar_base_rockylinux_8 # newest RHEL-based
+#  dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_base_centos
+#  base: true
 - name: app_sidecar_base_centos_7 # oldest supported RHEL-based
   dockerfile: pkg/test/echo/docker/Dockerfile.app_sidecar_base_centos
   base: true
-- 
2.35.3

