From 5c38f0dbd26089d06a0dd01d26c6cb65a579b04b Mon Sep 17 00:00:00 2001
From: Yang <940129520@qq.com>
Date: Fri, 18 Feb 2022 02:51:39 +0800
Subject: Add missing watch error handler for ingress class informer (#37408)

---
 pilot/pkg/config/kube/ingress/controller.go   | 5 +++++
 pilot/pkg/config/kube/ingressv1/controller.go | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/pilot/pkg/config/kube/ingress/controller.go b/pilot/pkg/config/kube/ingress/controller.go
index 8a03addec9..72f7f49b17 100644
--- a/pilot/pkg/config/kube/ingress/controller.go
+++ b/pilot/pkg/config/kube/ingress/controller.go
@@ -297,6 +297,11 @@ func (c *controller) SetWatchErrorHandler(handler func(r *cache.Reflector, err e
 	if err := c.ingressInformer.SetWatchErrorHandler(handler); err != nil {
 		errs = multierror.Append(err, errs)
 	}
+	if c.classes != nil {
+		if err := c.classes.Informer().SetWatchErrorHandler(handler); err != nil {
+			errs = multierror.Append(err, errs)
+		}
+	}
 	return errs
 }
 
diff --git a/pilot/pkg/config/kube/ingressv1/controller.go b/pilot/pkg/config/kube/ingressv1/controller.go
index 5fef8d6947..82d480441e 100644
--- a/pilot/pkg/config/kube/ingressv1/controller.go
+++ b/pilot/pkg/config/kube/ingressv1/controller.go
@@ -250,6 +250,9 @@ func (c *controller) SetWatchErrorHandler(handler func(r *cache.Reflector, err e
 	if err := c.ingressInformer.SetWatchErrorHandler(handler); err != nil {
 		errs = multierror.Append(err, errs)
 	}
+	if err := c.classes.Informer().SetWatchErrorHandler(handler); err != nil {
+		errs = multierror.Append(err, errs)
+	}
 	return errs
 }
 
-- 
2.35.3

