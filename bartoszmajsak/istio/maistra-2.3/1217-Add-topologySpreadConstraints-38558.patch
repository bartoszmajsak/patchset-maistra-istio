From 66c4246a26327369c5fde88ffaf1417987915fa4 Mon Sep 17 00:00:00 2001
From: Jesus Munoz <jesus.munoz@solo.io>
Date: Tue, 10 May 2022 22:53:09 +0200
Subject: Add topologySpreadConstraints (#38558)

---
 .../charts/gateway/templates/deployment.yaml     |  4 ++++
 manifests/charts/gateway/values.schema.json      |  3 +++
 manifests/charts/gateway/values.yaml             |  2 ++
 ..._chart_gateway_topologyspreadconstraints.yaml | 16 ++++++++++++++++
 4 files changed, 25 insertions(+)
 create mode 100644 releasenotes/notes/helm_chart_gateway_topologyspreadconstraints.yaml

diff --git a/manifests/charts/gateway/templates/deployment.yaml b/manifests/charts/gateway/templates/deployment.yaml
index 2f2d529f8b..ca2aa3f984 100644
--- a/manifests/charts/gateway/templates/deployment.yaml
+++ b/manifests/charts/gateway/templates/deployment.yaml
@@ -98,3 +98,7 @@ spec:
       tolerations:
         {{- toYaml . | nindent 8 }}
       {{- end }}
+      {{- with .Values.topologySpreadConstraints }}
+      topologySpreadConstraints:
+        {{- toYaml . | nindent 8 }}
+      {{- end }}
diff --git a/manifests/charts/gateway/values.schema.json b/manifests/charts/gateway/values.schema.json
index 9feb760cf5..a5c651b340 100644
--- a/manifests/charts/gateway/values.schema.json
+++ b/manifests/charts/gateway/values.schema.json
@@ -179,6 +179,9 @@
     "tolerations": {
       "type": "array"
     },
+    "topologySpreadConstraints": {
+      "type": "array"
+    },
     "networkGateway": {
       "type": "string"
     },
diff --git a/manifests/charts/gateway/values.yaml b/manifests/charts/gateway/values.yaml
index e054afb81d..e44610b948 100644
--- a/manifests/charts/gateway/values.yaml
+++ b/manifests/charts/gateway/values.yaml
@@ -83,6 +83,8 @@ nodeSelector: {}
 
 tolerations: []
 
+topologySpreadConstraints: []
+
 affinity: {}
 
 # If specified, the gateway will act as a network gateway for the given network.
diff --git a/releasenotes/notes/helm_chart_gateway_topologyspreadconstraints.yaml b/releasenotes/notes/helm_chart_gateway_topologyspreadconstraints.yaml
new file mode 100644
index 0000000000..2426a5e335
--- /dev/null
+++ b/releasenotes/notes/helm_chart_gateway_topologyspreadconstraints.yaml
@@ -0,0 +1,16 @@
+apiVersion: release-notes/v2
+kind: feature
+area: installation
+
+# issue is a list of GitHub issues resolved in this note.
+issue: []
+
+docs: []
+
+releaseNotes:
+- |
+  **Added** values to the Istio Gateway Helm chart for configuring [topologySpreadConstraints](https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/) on the Deployment. Can be used for better placement of Istio gateway workloads.
+
+upgradeNotes: []
+
+securityNotes: []
-- 
2.35.3

