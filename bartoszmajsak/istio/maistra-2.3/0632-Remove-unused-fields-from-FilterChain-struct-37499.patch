From 3f7773bb99f62b977184ba3b8da6643d48bbf0e9 Mon Sep 17 00:00:00 2001
From: Jacek Ewertowski <jacek.ewertowski1@gmail.com>
Date: Thu, 24 Feb 2022 11:43:37 +0100
Subject: Remove unused fields from FilterChain struct (#37499)

---
 pilot/pkg/networking/core/v1alpha3/gateway.go | 8 +++-----
 pilot/pkg/networking/networking.go            | 9 ---------
 2 files changed, 3 insertions(+), 14 deletions(-)

diff --git a/pilot/pkg/networking/core/v1alpha3/gateway.go b/pilot/pkg/networking/core/v1alpha3/gateway.go
index 1e72be4d6e..18f8cc9047 100644
--- a/pilot/pkg/networking/core/v1alpha3/gateway.go
+++ b/pilot/pkg/networking/core/v1alpha3/gateway.go
@@ -220,8 +220,7 @@ func (configgen *ConfigGeneratorImpl) buildGatewayTCPBasedFilterChains(
 				tcpFilterChainOpts = append(tcpFilterChainOpts, configgen.createGatewayHTTPFilterChainOpts(builder.node, server.Port, server,
 					routeName, proxyConfig, istionetworking.TransportProtocolTCP))
 				newFilterChains = append(newFilterChains, istionetworking.FilterChain{
-					ListenerProtocol:   istionetworking.ListenerProtocolHTTP,
-					IstioMutualGateway: server.Tls.Mode == networking.ServerTLSSettings_ISTIO_MUTUAL,
+					ListenerProtocol: istionetworking.ListenerProtocolHTTP,
 				})
 			} else {
 				// This is the case of TCP or PASSTHROUGH.
@@ -263,9 +262,8 @@ func (configgen *ConfigGeneratorImpl) buildGatewayHTTP3FilterChains(
 			// Make sure that this is set to HTTP so that JWT and Authorization
 			// filters that are applied to HTTPS are also applied to this chain.
 			// Not doing so is a security hole as would allow bypassing auth.
-			ListenerProtocol:   istionetworking.ListenerProtocolHTTP,
-			TransportProtocol:  istionetworking.TransportProtocolQUIC,
-			IstioMutualGateway: server.Tls.Mode == networking.ServerTLSSettings_ISTIO_MUTUAL,
+			ListenerProtocol:  istionetworking.ListenerProtocolHTTP,
+			TransportProtocol: istionetworking.TransportProtocolQUIC,
 		})
 	}
 	opts.filterChainOpts = quicFilterChainOpts
diff --git a/pilot/pkg/networking/networking.go b/pilot/pkg/networking/networking.go
index 716f793837..fc386351c3 100644
--- a/pilot/pkg/networking/networking.go
+++ b/pilot/pkg/networking/networking.go
@@ -123,26 +123,17 @@ type FilterChain struct {
 	FilterChainMatch *listener.FilterChainMatch
 	// TLSContext is the TLS settings for this filter chains.
 	TLSContext *tls.DownstreamTlsContext
-	// ListenerFilters are the filters needed for the whole listener, not particular to this
-	// filter chain.
-	ListenerFilters []*listener.ListenerFilter
 	// ListenerProtocol indicates whether this filter chain is for HTTP or TCP
 	// Note that HTTP filter chains can also have network filters
 	ListenerProtocol ListenerProtocol
 	// TransportProtocol indicates the type of transport used - TCP, UDP, QUIC
 	// This would be TCP by default
 	TransportProtocol TransportProtocol
-	// IstioMutualGateway is set only when this filter chain is part of a Gateway, and
-	// the Server corresponding to this filter chain is doing TLS termination with ISTIO_MUTUAL as the TLS mode.
-	// This allows the authN plugin to add the istio_authn filter to gateways in addition to sidecars.
-	IstioMutualGateway bool
 
 	// HTTP is the set of HTTP filters for this filter chain
 	HTTP []*http_conn.HttpFilter
 	// TCP is the set of network (TCP) filters for this filter chain.
 	TCP []*listener.Filter
-	// IsFallthrough indicates if the filter chain is fallthrough.
-	IsFallThrough bool
 }
 
 // MutableObjects is a set of objects passed to On*Listener callbacks. Fields may be nil or empty.
-- 
2.35.3

