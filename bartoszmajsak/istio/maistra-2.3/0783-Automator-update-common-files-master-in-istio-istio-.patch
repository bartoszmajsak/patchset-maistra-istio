From 6db9088e7b8cd6dc3ccda0604265f4ccf4466a0d Mon Sep 17 00:00:00 2001
From: Istio Automation <istio-testing-bot@google.com>
Date: Fri, 11 Mar 2022 15:17:56 -0800
Subject: Automator: update common-files@master in istio/istio@master (#37882)

---
 common/.commonfiles.sha            | 2 +-
 common/scripts/kind_provisioner.sh | 8 ++++----
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/common/.commonfiles.sha b/common/.commonfiles.sha
index 21d137ee5b..172d52bd5c 100644
--- a/common/.commonfiles.sha
+++ b/common/.commonfiles.sha
@@ -1 +1 @@
-4ad508c01531a886e8aa12b4d0cd26ca9cfa6107
+4f7a47a2619aa100ebdec34dc4a0369204c1c01c
diff --git a/common/scripts/kind_provisioner.sh b/common/scripts/kind_provisioner.sh
index 8576087c65..a4fa30e3d4 100644
--- a/common/scripts/kind_provisioner.sh
+++ b/common/scripts/kind_provisioner.sh
@@ -170,11 +170,11 @@ function setup_kind_cluster() {
     # Kubernetes 1.15+
     CONFIG=${DEFAULT_CLUSTER_YAML}
     # Configure the cluster IP Family only for default configs
-    if [ "${IP_FAMILY}" = "ipv6" ]; then
-      grep 'ipFamily: ipv6' "${CONFIG}" || \
+    if [ "${IP_FAMILY}" != "ipv4" ]; then
+      grep "ipFamily: ${IP_FAMILY}" "${CONFIG}" || \
       cat <<EOF >> "${CONFIG}"
 networking:
-  ipFamily: ipv6
+  ipFamily: ${IP_FAMILY}
 EOF
     fi
   fi
@@ -202,7 +202,7 @@ EOF
   # https://github.com/coredns/coredns/issues/2494#issuecomment-457215452
   # CoreDNS should handle those domains and answer with NXDOMAIN instead of SERVFAIL
   # otherwise pods stops trying to resolve the domain.
-  if [ "${IP_FAMILY}" = "ipv6" ]; then
+  if [ "${IP_FAMILY}" = "ipv6" ] || [ "${IP_FAMILY}" = "dual" ]; then
       # Get the current config
       original_coredns=$(kubectl get -oyaml -n=kube-system configmap/coredns)
       echo "Original CoreDNS config:"
-- 
2.35.3

