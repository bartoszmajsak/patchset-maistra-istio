From 9a9f4ce6fdccc36c34fb6d2f656fa4a9ef2ea04b Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Tue, 24 May 2022 23:29:35 +0800
Subject: Fix test flake by using sync controller (#39105)

---
 pilot/pkg/serviceregistry/serviceentry/controller_test.go | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pilot/pkg/serviceregistry/serviceentry/controller_test.go b/pilot/pkg/serviceregistry/serviceentry/controller_test.go
index d2a779ac12..4fab61a9d2 100644
--- a/pilot/pkg/serviceregistry/serviceentry/controller_test.go
+++ b/pilot/pkg/serviceregistry/serviceentry/controller_test.go
@@ -172,7 +172,7 @@ func initServiceDiscoveryWithoutEvents(t test.Failer) (model.ConfigStore, *Contr
 
 func initServiceDiscoveryWithOpts(t test.Failer, workloadOnly bool, opts ...Option) (model.ConfigStore, *Controller, chan Event) {
 	store := memory.Make(collections.Pilot)
-	configController := memory.NewController(store)
+	configController := memory.NewSyncController(store)
 
 	stop := test.NewStop(t)
 	go configController.Run(stop)
-- 
2.35.3

