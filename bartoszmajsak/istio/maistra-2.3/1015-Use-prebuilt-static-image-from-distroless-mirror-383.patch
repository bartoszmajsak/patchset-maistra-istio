From a9a537884d2bae025c05f11601f79a41ffdd25d1 Mon Sep 17 00:00:00 2001
From: sergii-ssh <83605538+sergii-ssh@users.noreply.github.com>
Date: Tue, 12 Apr 2022 13:52:40 -0400
Subject: Use prebuilt static image from distroless mirror (#38344)

---
 docker/Dockerfile.distroless | 23 +++--------------------
 1 file changed, 3 insertions(+), 20 deletions(-)

diff --git a/docker/Dockerfile.distroless b/docker/Dockerfile.distroless
index 61c5dbe5d4..d705b98959 100644
--- a/docker/Dockerfile.distroless
+++ b/docker/Dockerfile.distroless
@@ -1,20 +1,3 @@
-# prepare a distroless source context to copy files from
-FROM gcr.io/distroless/static-debian11@sha256:8ad6f3ec70dad966479b9fb48da991138c72ba969859098ec689d1450c2e6c97 as distroless_source
-
-# prepare a base dev to modify file contents
-FROM ubuntu:focal as ubuntu_source
-
-# Modify contents of container
-COPY --from=distroless_source /etc/ /home/etc
-COPY --from=distroless_source /home/nonroot /home/nonroot
-RUN echo istio-proxy:x:1337: >> /home/etc/group
-RUN echo istio-proxy:x:1337:1337:istio-proxy:/nonexistent:/sbin/nologin >> /home/etc/passwd
-
-# Customize distroless with the following:
-# - password file
-# - groups file
-# - /home/nonroot directory
-FROM distroless_source
-COPY --from=ubuntu_source /home/etc/passwd /etc/passwd
-COPY --from=ubuntu_source /home/etc/group /etc/group
-COPY --from=ubuntu_source /home/nonroot /home/nonroot
+# istio-static image is prebuilt with 1337:1337.
+# https://github.com/istio/distroless/tree/iptables/istio
+FROM gcr.io/istio-release/distroless/istio-static@sha256:6330bd7b07d70fe4277af99c6bba96236ae3f415417b13a4563f29bcf6208062 as distroless_source
\ No newline at end of file
-- 
2.35.3

