From bbaaf6d79edace0c1dc20497a8306330ac9458b0 Mon Sep 17 00:00:00 2001
From: Shiming Zhang <wzshiming@foxmail.com>
Date: Wed, 24 Nov 2021 07:12:11 +0800
Subject: operator/pkg/util/tgz: Fix not closing file when file write failed
 (#36218)

---
 operator/pkg/util/tgz/tgz.go | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/operator/pkg/util/tgz/tgz.go b/operator/pkg/util/tgz/tgz.go
index 0dec5f0418..b582e2c90e 100644
--- a/operator/pkg/util/tgz/tgz.go
+++ b/operator/pkg/util/tgz/tgz.go
@@ -58,12 +58,11 @@ func Create(srcDir, outPath string) error {
 		if err != nil {
 			return err
 		}
+		defer f.Close()
+
 		if _, err := io.Copy(tw, f); err != nil {
 			return err
 		}
-
-		f.Close()
-
 		return nil
 	})
 }
-- 
2.35.3

