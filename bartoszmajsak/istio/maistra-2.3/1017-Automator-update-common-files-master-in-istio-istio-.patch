From 140f9de06e9a9fddc81395cb03076995aae0de06 Mon Sep 17 00:00:00 2001
From: Istio Automation <istio-testing-bot@google.com>
Date: Tue, 12 Apr 2022 11:26:41 -0700
Subject: Automator: update common-files@master in istio/istio@master (#38349)

---
 common/.commonfiles.sha            |  2 +-
 common/config/.golangci.yml        | 66 ++++++++++++++++++++++++++++--
 common/scripts/kind_provisioner.sh |  2 +
 3 files changed, 65 insertions(+), 5 deletions(-)

diff --git a/common/.commonfiles.sha b/common/.commonfiles.sha
index e7c8af46d4..7c441679de 100644
--- a/common/.commonfiles.sha
+++ b/common/.commonfiles.sha
@@ -1 +1 @@
-140943d3b957290ff320ad67f5e8beee0aa2612a
+d309fa11788426a813280dc0ab06e160893d0dad
diff --git a/common/config/.golangci.yml b/common/config/.golangci.yml
index 558cbe6555..6867b5ce5b 100644
--- a/common/config/.golangci.yml
+++ b/common/config/.golangci.yml
@@ -40,7 +40,7 @@ linters:
   - gocritic
   - gofumpt
   - goimports
-  - golint
+  - revive
   - gosimple
   - govet
   - ineffassign
@@ -67,9 +67,6 @@ linters-settings:
   govet:
     # report about shadowed variables
     check-shadowing: false
-  golint:
-    # minimal confidence for issues, default is 0.8
-    min-confidence: 0.0
   goimports:
     # put imports beginning with prefix after 3rd-party packages;
     # it's a comma-separated list of prefixes
@@ -90,6 +87,67 @@ linters-settings:
     line-length: 160
     # tab width in spaces. Default to 1.
     tab-width: 1
+  revive:
+    ignore-generated-header: false
+    severity: "warning"
+    confidence: 0.0
+    error-code: 2
+    warning-code: 1
+    rules:
+    - name: blank-imports
+    - name: context-keys-type
+    - name: time-naming
+    - name: var-declaration
+    - name: unexported-return
+    - name: errorf
+    - name: context-as-argument
+    - name: dot-imports
+    - name: error-return
+    - name: error-strings
+    - name: error-naming
+    - name: increment-decrement
+    - name: var-naming
+    - name: package-comments
+    - name: range
+    - name: receiver-naming
+    - name: indent-error-flow
+    - name: superfluous-else
+    - name: modifies-parameter
+    - name: unreachable-code
+    - name: struct-tag
+    - name: constant-logical-expr
+    - name: bool-literal-in-expr
+    - name: redefines-builtin-id
+    - name: imports-blacklist
+    - name: range-val-in-closure
+    - name: range-val-address
+    - name: waitgroup-by-value
+    - name: atomic
+    - name: call-to-gc
+    - name: duplicated-imports
+    - name: string-of-int
+    - name: defer
+      arguments: [["call-chain"]]
+    - name: unconditional-recursion
+    - name: identical-branches
+    # the following rules can be enabled in the future
+    # - name: empty-lines
+    # - name: confusing-results
+    # - name: empty-block
+    # - name: get-return
+    # - name: confusing-naming
+    # - name: unexported-naming
+    # - name: early-return
+    # - name: unused-parameter
+    # - name: unnecessary-stmt
+    # - name: deep-exit
+    # - name: import-shadowing
+    # - name: modifies-value-receiver
+    # - name: unused-receiver
+    # - name: bare-return
+    # - name: flag-parameter
+    # - name: unhandled-error
+    # - name: if-return
   unused:
     # treat code as a program (not a library) and report unused exported identifiers; default is false.
     # XXX: if you enable this setting, unused will report a lot of false-positives in text editors:
diff --git a/common/scripts/kind_provisioner.sh b/common/scripts/kind_provisioner.sh
index a4fa30e3d4..70c32e6dd0 100644
--- a/common/scripts/kind_provisioner.sh
+++ b/common/scripts/kind_provisioner.sh
@@ -184,6 +184,8 @@ EOF
     echo "Could not setup KinD environment. Something wrong with KinD setup. Exporting logs."
     return 9
   fi
+  # Workaround kind issue causing taints to not be removed in 1.24
+  kubectl taint nodes "${NAME}"-control-plane node-role.kubernetes.io/control-plane- || true
 
   # If metrics server configuration directory is specified then deploy in
   # the cluster just created
-- 
2.35.3

