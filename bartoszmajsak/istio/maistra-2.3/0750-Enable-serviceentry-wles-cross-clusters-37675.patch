From ee009d1256c9d967545322f2ab7ed00f4ba2bdf7 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Wed, 9 Mar 2022 02:48:53 +0800
Subject: Enable serviceentry wles cross clusters (#37675)

---
 pilot/pkg/serviceregistry/kube/controller/multicluster.go | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/pilot/pkg/serviceregistry/kube/controller/multicluster.go b/pilot/pkg/serviceregistry/kube/controller/multicluster.go
index 60a30925fa..9a6161b7a1 100644
--- a/pilot/pkg/serviceregistry/kube/controller/multicluster.go
+++ b/pilot/pkg/serviceregistry/kube/controller/multicluster.go
@@ -192,6 +192,8 @@ func (m *Multicluster) ClusterAdded(cluster *multicluster.Cluster, clusterStopCh
 				serviceentry.WithNetworkIDCb(kubeRegistry.Network))
 			// Services can select WorkloadEntry from the same cluster. We only duplicate the Service to configure kube-dns.
 			m.remoteKubeControllers[cluster.ID].workloadEntryStore.AppendWorkloadHandler(kubeRegistry.WorkloadInstanceHandler)
+			// ServiceEntry selects WorkloadEntry from remote cluster
+			m.remoteKubeControllers[cluster.ID].workloadEntryStore.AppendWorkloadHandler(m.serviceEntryStore.WorkloadInstanceHandler)
 			m.opts.MeshServiceController.AddRegistryAndRun(m.remoteKubeControllers[cluster.ID].workloadEntryStore, clusterStopCh)
 			go configStore.Run(clusterStopCh)
 		} else {
-- 
2.35.3

