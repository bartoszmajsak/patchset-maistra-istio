From b9431f90757803903e6603d3e0f1fae83914d6fb Mon Sep 17 00:00:00 2001
From: Zack Zhang <zhangkaiamm@gmail.com>
Date: Fri, 5 Nov 2021 11:15:14 +0800
Subject: optimize codes, the logic that apply pilot default args should be
 placed together (#35913)

Signed-off-by: zackzhangkai <zhangkaiamm@gmail.com>
---
 pilot/pkg/bootstrap/options.go | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/pilot/pkg/bootstrap/options.go b/pilot/pkg/bootstrap/options.go
index ed24340810..652dc60122 100644
--- a/pilot/pkg/bootstrap/options.go
+++ b/pilot/pkg/bootstrap/options.go
@@ -134,13 +134,6 @@ func NewPilotArgs(initFuncs ...func(*PilotArgs)) *PilotArgs {
 		fn(p)
 	}
 
-	// Set the ClusterRegistries namespace based on the selected namespace.
-	if p.Namespace != "" {
-		p.RegistryOptions.ClusterRegistriesNamespace = p.Namespace
-	} else {
-		p.RegistryOptions.ClusterRegistriesNamespace = constants.IstioSystemNamespace
-	}
-
 	return p
 }
 
@@ -153,6 +146,7 @@ func (p *PilotArgs) applyDefaults() {
 	p.KeepaliveOptions = keepalive.DefaultOption()
 	p.RegistryOptions.DistributionTrackingEnabled = features.EnableDistributionTracking
 	p.RegistryOptions.DistributionCacheRetention = features.DistributionHistoryRetention
+	p.RegistryOptions.ClusterRegistriesNamespace = p.Namespace
 }
 
 func (p *PilotArgs) Complete() error {
-- 
2.35.3

