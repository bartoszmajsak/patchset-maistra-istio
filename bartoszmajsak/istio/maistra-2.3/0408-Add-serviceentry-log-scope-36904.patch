From 07d29f13f9733281d95a8dca1223e37722d1de97 Mon Sep 17 00:00:00 2001
From: Zhonghu Xu <xuzhonghu@huawei.com>
Date: Thu, 20 Jan 2022 17:26:50 +0800
Subject: Add serviceentry log scope (#36904)

---
 pilot/pkg/serviceregistry/serviceentry/servicediscovery.go | 7 +++++--
 .../serviceregistry/serviceentry/servicediscovery_test.go  | 3 +--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go b/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
index b06a35e661..8f5a9eaa34 100644
--- a/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
+++ b/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
@@ -38,10 +38,13 @@
 	"istio.io/istio/pkg/config/schema/gvk"
 	"istio.io/istio/pkg/network"
 	"istio.io/istio/pkg/queue"
-	"istio.io/pkg/log"
+	istiolog "istio.io/pkg/log"
 )
 
-var _ serviceregistry.Instance = &ServiceEntryStore{}
+var (
+	_   serviceregistry.Instance = &ServiceEntryStore{}
+	log                          = istiolog.RegisterScope("serviceentry", "ServiceEntry registry", 0)
+)
 
 // instancesKey acts as a key to identify all instances for a given hostname/namespace pair
 // This is mostly used as an index
diff --git a/pilot/pkg/serviceregistry/serviceentry/servicediscovery_test.go b/pilot/pkg/serviceregistry/serviceentry/servicediscovery_test.go
index c9fa765210..914098b87b 100644
--- a/pilot/pkg/serviceregistry/serviceentry/servicediscovery_test.go
+++ b/pilot/pkg/serviceregistry/serviceentry/servicediscovery_test.go
@@ -38,7 +38,6 @@
 	"istio.io/istio/pkg/spiffe"
 	"istio.io/istio/pkg/test"
 	"istio.io/istio/pkg/test/util/retry"
-	"istio.io/pkg/log"
 )
 
 func createConfigs(configs []*config.Config, store model.IstioConfigStore, t testing.TB) {
@@ -1086,7 +1085,7 @@ func expectEvents(t testing.TB, ch chan Event, events ...Event) {
 	for {
 		select {
 		case e := <-ch:
-			log.Warnf("ignoring event %+v", e)
+			t.Logf("ignoring event %+v", e)
 			if len(events) == 0 {
 				t.Fatalf("got unexpected event %+v", e)
 			}
-- 
2.35.3

