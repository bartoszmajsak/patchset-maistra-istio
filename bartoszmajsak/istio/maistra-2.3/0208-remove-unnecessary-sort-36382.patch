From f5640ca8c0ed5cf32b0c1eba03027671aff701de Mon Sep 17 00:00:00 2001
From: Rama Chavali <rama.rao@salesforce.com>
Date: Mon, 6 Dec 2021 22:35:44 +0530
Subject: remove unnecessary sort (#36382)

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>
---
 .../serviceregistry/kube/controller/controller.go    |  2 --
 .../serviceregistry/serviceentry/servicediscovery.go |  2 +-
 pilot/pkg/serviceregistry/serviceentry/store.go      | 12 ++++++------
 pilot/pkg/serviceregistry/serviceentry/store_test.go |  2 +-
 4 files changed, 8 insertions(+), 10 deletions(-)

diff --git a/pilot/pkg/serviceregistry/kube/controller/controller.go b/pilot/pkg/serviceregistry/kube/controller/controller.go
index da8773a8e0..91930355fb 100644
--- a/pilot/pkg/serviceregistry/kube/controller/controller.go
+++ b/pilot/pkg/serviceregistry/kube/controller/controller.go
@@ -17,7 +17,6 @@
 import (
 	"fmt"
 	"net"
-	"sort"
 	"sync"
 	"time"
 
@@ -877,7 +876,6 @@ func (c *Controller) Services() ([]*model.Service, error) {
 		out = append(out, svc)
 	}
 	c.RUnlock()
-	sort.Slice(out, func(i, j int) bool { return out[i].Hostname < out[j].Hostname })
 	return out, nil
 }
 
diff --git a/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go b/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
index 4f49ee1c62..0d20018609 100644
--- a/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
+++ b/pilot/pkg/serviceregistry/serviceentry/servicediscovery.go
@@ -134,7 +134,7 @@ func NewServiceDiscovery(
 			instancesByKey: map[types.NamespacedName]*model.WorkloadInstance{},
 		},
 		services: serviceStore{
-			servicesBySE: map[types.NamespacedName][]*model.Service{},
+			services: map[types.NamespacedName][]*model.Service{},
 		},
 		edsQueue:            queue.NewQueue(time.Second),
 		processServiceEntry: true,
diff --git a/pilot/pkg/serviceregistry/serviceentry/store.go b/pilot/pkg/serviceregistry/serviceentry/store.go
index bd7de4449c..2a1606fbbd 100644
--- a/pilot/pkg/serviceregistry/serviceentry/store.go
+++ b/pilot/pkg/serviceregistry/serviceentry/store.go
@@ -148,26 +148,26 @@ func (w *workloadInstancesStore) update(wi *model.WorkloadInstance) {
 // stores all the services converted from serviceEntries
 type serviceStore struct {
 	// services keeps track of all services - mainly used to return from Services() to avoid reconversion.
-	servicesBySE map[types.NamespacedName][]*model.Service
+	services map[types.NamespacedName][]*model.Service
 }
 
 func (s *serviceStore) getAllServices() []*model.Service {
 	var out []*model.Service
-	for _, svcs := range s.servicesBySE {
+	for _, svcs := range s.services {
 		out = append(out, svcs...)
 	}
 
-	return model.SortServicesByCreationTime(out)
+	return out
 }
 
 func (s *serviceStore) getServices(key types.NamespacedName) []*model.Service {
-	return s.servicesBySE[key]
+	return s.services[key]
 }
 
 func (s *serviceStore) deleteServices(key types.NamespacedName) {
-	delete(s.servicesBySE, key)
+	delete(s.services, key)
 }
 
 func (s *serviceStore) updateServices(key types.NamespacedName, services []*model.Service) {
-	s.servicesBySE[key] = services
+	s.services[key] = services
 }
diff --git a/pilot/pkg/serviceregistry/serviceentry/store_test.go b/pilot/pkg/serviceregistry/serviceentry/store_test.go
index d157b8bb36..5d7a956f34 100644
--- a/pilot/pkg/serviceregistry/serviceentry/store_test.go
+++ b/pilot/pkg/serviceregistry/serviceentry/store_test.go
@@ -179,7 +179,7 @@ func TestWorkloadInstancesStore(t *testing.T) {
 
 func TestServiceStore(t *testing.T) {
 	store := serviceStore{
-		servicesBySE: map[types.NamespacedName][]*model.Service{},
+		services: map[types.NamespacedName][]*model.Service{},
 	}
 
 	expectedServices := []*model.Service{
-- 
2.35.3

